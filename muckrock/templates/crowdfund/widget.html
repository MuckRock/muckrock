{% load humanize %}
{% load static from staticfiles %}

<section class="crowdfund widget">
    <div class="overlay hidden"></div>
    <header>
        <h1>{{ crowdfund.name }}</h1>
        <!--<a href="/docs/crowdfund/">What is this?</a>-->
    </header>
    <section class="description">
        <p>{{ crowdfund.description }}</p>
    </section>
    <section class="stats">
        <div class="contributors">
            <p class="contributor summary">{{ contributor_summary }}</p>
        {% if crowdfund.contributors|length > 0 %}
            <ul class="contributor dropdown">
            {% for contributor in crowdfund.named_contributors %}
                <li>{{ contributor.get_full_name }}</li>
            {% endfor %}
            {% if crowdfund.anonymous_contributors %}
                <li>{{ crowdfund.anonymous_contributors|length }} anonymous donors</li>
            {% endif %}
            </ul>
        </div>
        {% endif %}
        <p class="amount-raised">${{ crowdfund.payment_received|intcomma }} raised out of ${{ crowdfund.payment_required|intcomma }}.</p>
        <p class="time-remaining">
        {% if not crowdfund.expired %}
            {{ crowdfund.date_due|timeuntil }} remaining
        {% else %}
            This crowdfund has ended.
        {% endif %}
        </p>
    </section>
    {% if not crowdfund.expired %}
    <footer>
        <form method="POST" action="{{ endpoint }}" class="crowdfund-form" id="crowdfund-form">
            <section class="anonymity">
                {% if logged_in %}
                {{ payment_form.show }}
                <label for="id_show">List me as a contributor.</label>
                {% else %}
                <p>To be listed as a contributor,<br>please <a href="{% url 'acct-login' %}">log in</a> or <a href="{% url 'acct-register' %}">sign up</a>.</p>
                <input name="show" value="False" hidden>
                {% endif %}
            </section>
            <section class="amount">
                {{ payment_form.amount }}
            </section>
            <section class="action">
                <button data-email="{{ user_email }}"
                        data-icon="{% static 'apple-touch-icon.png' %}"
                        data-key="{{ stripe_pk }}"
                        id="crowdfund-button">
                    Contribute
                </button>
            </section>
            {% csrf_token %}
            {{ payment_form.crowdfund }}
        </form>
    </footer>
    {% endif %}
</section>
