{% load humanize %}
{% load static from staticfiles %}

{% if not crowdfund.expired %}

<section class="crowdfund widget">
    <div class="overlay hidden"></div>
    <header>
        <h1>{{ crowdfund.name }}</h1>
        <!--<a href="/docs/crowdfund/">What is this?</a>-->
    </header>
    <section class="description">
        <p>{{ crowdfund.description }}</p>
    </section>
    <section class="stats">
        {% with crowdfund.contributors|length as num_contribs %}
        <p class="contributors">
            {% if num_contribs == 1 %}
            1 person has contributed.
            {% else %}
                {% if num_contribs > 0 %}
            {{ num_contribs }} people have contributed.
                {% else %}
            Nobody has contributed. Be the first!
                {% endif %}
            {% endif %}
        </p>
        {% endwith %}
        <p class="amount-raised">${{ crowdfund.payment_received|intcomma }} raised out of ${{ crowdfund.payment_required|intcomma }}.</p>
        <p class="time-remaining">{{ crowdfund.date_due|timeuntil }} remaining</p>
    </section>
    <footer>
        <form method="POST" action="{{ endpoint }}" class="crowdfund-form" id="crowdfund-form">
            <section class="anonymity">
                {% if logged_in %}
                {{ payment_form.show }}
                <label for="id_show">List me as a contributor.</label>
                {% else %}
                <p>To be listed as a contributor,<br>please <a href="{% url 'acct-login' %}">log in</a> or <a href="{% url 'acct-register' %}">sign up</a>.</p>
                <input name="show" value="False" hidden>
                {% endif %}
            </section>
            <section class="amount">
                {{ payment_form.amount }}
            </section>
            <section class="action">
                <button data-email="{{ user_email }}"
                        data-icon="{% static 'apple-touch-icon.png' %}"
                        data-key="{{ stripe_pk }}"
                        id="crowdfund-button">
                    Contribute
                </button>
            </section>
            {% csrf_token %}
            {{ payment_form.crowdfund }}
        </form>
    </footer>
</section>

{% else %}

<section class="expired crowdfund panel">
    <h1>This crowdfund has ended.</h1>
    <p>It raised ${{ crowdfund.payment_received|intcomma }}.</p>
</section>

{% endif %}
