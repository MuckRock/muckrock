{% extends 'base.html' %}
{% load thumbnail %}
{% load markdown_deux_tags %}
{% load static from staticfiles %}

{% block content %}
<div class="project frontpage">
    {# The header explains what projects are and calls users to create their own. #}
    <header class="frontpage-header">
        <div class="overview">
            <h1>Projects <span class="primary badge">BETA</span></h1>
            <p>Projects collect requests and articles to tell larger stories. Using MuckRock to launch, fund, and manage your project gives your readers an easy way to support and follow along with your progress.</p>
            <ul class="nostyle inline">
                {% if request.user.is_staff %}
                <li><a class="primary button" href="{% url 'project-create' %}">Create a project</a></li>
                {% else %}
                <li><a class="primary button" href="mailto:info@muckrock.com?subject=Projects%20Beta&body=I would like access to the projects beta.">Request beta access</a></li>
                {% endif %}
                <li><a href="{% url 'project-list' %}">See all projects</a></li>
                <li><a href="https://www.muckrock.com/news/archives/2015/sep/03/muckrock-projects-organize-crowdfund-journalism/">Learn more</a></li>
            </ul>
        </div>
    </header>
    {% comment %}
    Featured projects are given top billing. If they have an active crowdfund, we place that on the right-hand
    side of the section and give it a call to action. If they don't, we display project stats and make following
    the call to action.
    {% endcomment %}
    <div class="featured">
        {% for project in featured %}
        <div class="project">
            <header class="project-header" style="background-image: url('{% thumbnail project.image 400x300 crop %}');">
                <a href="{{project.get_absolute_url}}" class="project-header-wrapper">
                    <h2 class="title">{{project.title}}</h2>
                </a>
            </header>
            <div class="overview">

                <ul class="nostyle inline stats">
                {% if project.requests.exists %}
                    <li class="stat"><a href="{{project.get_absolute_url}}#requests"><span class="value">{{project.requests.count}}</span> request{{project.requests.count|pluralize}}</a></li>
                {% endif %}
                {% if project.articles.exists %}
                    <li class="stat"><a href="{{project.get_absolute_url}}#articles"><span class="value">{{project.articles.count}}</span> article{{project.articles.count|pluralize}}</a></li>
                {% endif %}
                </ul>
                <summary>
                    {{project.summary|markdown}}
                </summary>
                <p class="more"><a href="{{project.get_absolute_url}}">Learn more</a></p>
            </div>
            <div class="details">
                {% if project.crowdfunds.exists %}
                {% with project.crowdfunds.last as crowdfund %}
                <div class="crowdfund">
                    <div class="progress"><span class="meter" style="width: {{crowdfund.percent_funded}}%"></span></div>
                    <ul class="nostyle inline stats">
                        <li class="stat"><span class="value">{{crowdfund.percent_funded}}%</span> funded</li>
                        <li class="stat"><span class="value">${{crowdfund.payment_received}}</span> raised</li>
                        <li class="stat"><span class="value">{{crowdfund.contributors_count}}</span> backer{{crowdfund.contributors_count|pluralize}}</li>
                        {% if crowdfund.closed %}
                        <li class="stat"><span class="value">Ended</li>
                        {% else %}
                        <li class="stat"><span class="value">{{crowdfund.date_due|timeuntil}}</span> remaining</li>
                        {% endif %}
                    </ul>
                    {% if not crowdfund.closed %}
                    <a class="success button" href="{{project.get_absolute_url}}#crowdfund-{{crowdfund.id}}">Contribute</a>
                    {% endif %}
                </div>
                {% endwith %}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
