{% load thumbnail %}

<div class="project component">
    {% if project.image %}
    <header class="project-header" style="background-image: url('{% thumbnail project.image 1200x600 crop %}');">
    {% else %}
    <header class="project-header">
    {% endif %}
        <a href="{{project.get_absolute_url}}" class="project-header-wrapper">
            <div>
                {% if project.featured %}
                <span class="small blue badge">&#9733; Featured</span>
                {% endif %}
                {% if project.private %}
                <span class="small red badge">&empty; Private</span>
                {% elif not project.approved %}
                <span class="small badge">Pending Approval</span>
                {% endif %}
                <h2 class="title">{{project.title}}</h2>
            </div>
        </a>
    </header>
    <div class="overview">
        <ul class="nostyle inline stats">
        {% if project.request_count %}
            <li class="stat"><a href="{{project.get_absolute_url}}#requests"><span class="value">{{project.request_count}}</span> request{{project.request_count|pluralize}}</a></li>
        {% endif %}
        {% if project.article_count %}
            <li class="stat"><a href="{{project.get_absolute_url}}#articles"><span class="value">{{project.article_count}}</span> article{{project.article_count|pluralize}}</a></li>
        {% endif %}
        </ul>
        <summary>
            {{project.summary|truncatewords:50}}
        </summary>
        <p class="more"><a href="{{project.get_absolute_url}}">Learn more</a></p>
    </div>
    {% if project.crowdfunds.exists %}
    <div class="details">
        {% with project.crowdfunds.first as crowdfund %}
        <div class="crowdfund">
            <div class="progress"><span class="meter" style="width: {{crowdfund.percent_funded}}%"></span></div>
            <ul class="nostyle inline stats">
                <li class="stat"><span class="value">{{crowdfund.percent_funded}}%</span> funded</li>
                <li class="stat"><span class="value">${{crowdfund.payment_received}}</span> raised</li>
                <li class="stat"><span class="value">{{crowdfund.contributors_count}}</span> backer{{crowdfund.contributors_count|pluralize}}</li>
                {% if crowdfund.expired %}
                <li class="stat"><span class="value">Ended</li>
                {% else %}
                <li class="stat"><span class="value">{{crowdfund.date_due|timeuntil}}</span> remaining</li>
                {% endif %}
            </ul>
            {% if not crowdfund.expired %}
            <a class="success button" href="{{project.get_absolute_url}}#crowdfund-{{crowdfund.id}}">Contribute</a>
            {% endif %}
        </div>
        {% endwith %}
    </div>
    {% endif %}
</div>
