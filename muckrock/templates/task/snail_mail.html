{% extends 'task/default.html' %}

{% block task-content %}
<dl class="task-data">
{% with task.communication.foia as foia %}
    <dt>Category</dt>
    <dd>{{task.get_category_display}}</dd>
{% if task.amount %}
    <dt>Amount</dt>
    <dd class="success">${{task.amount|floatformat:2}}</dd>
{% endif %}
{% if foia %}
    <dt>Is Acknowledged</dt>
    <dd>{{foia.has_ack|yesno:"True,False"}}</dd>
    <dt>Submitter</dt>
    <dd><a href="{% url 'admin:auth_user_change' foia.user.pk %}">{{foia.user}}</a></dd>
    <dt>Request</dt>
    <dd><a href="{{foia.get_absolute_url}}">{{foia}}</a> (<a href="{% url 'admin:foia_foiarequest_change' foia.pk %}">admin</a>)</dd>
    {# agency info #}
    {% if not appeal %}
        {% if foia.agency %}
    <dt>Agency</dt>
    <dd><a href="{% url 'admin:agency_agency_change' foia.agency.pk %}">{{foia.agency}}</a></dd>
            {% if foia.agency.email %}
    <dt>Agency Email</dt>
    <dd>{{foia.agency.email}}</dd>
            {% endif %}
            {% if foia.agency.fax %}
    <dt>Agency Fax</dt>
    <dd>{{foia.agency.fax}}@fax2.faxaway.com</dd>
            {% endif %}
            {% if foia.agency.address %}
    <dt>Agency Address</dt>
    <dd>{{foia.agency.address|linebreaks}}</dd>
            {% endif %}
            {% if foia.agency.notes and not foia.agency.email and not foia.agency.fax %}
    <dt>Agency Notes</dt>
    <dd>{{foia.agency.notes}}</dd>
            {% endif %}
        {% endif %}
    {% else %}
        {% if foia.agency.appeal_agency %}
    <dt>Appeal Agency</dt>
    <dd><a href="{% url 'admin:agency_agency_change' foia.agency.appeal_agency.pk %}">{{foia.agency.appeal_agency}}</a></dd>
            {% if foia.agency.appeal_agency.address %}
    <dt>Appeal Agency Address</dt>
    <dd>{{foia.agency.appeal_agency.address|linebreaks}}</dd>
            {% endif %}
        {% endif %}
    {% endif %}
{% endif %}
</dl>
<div class="collapsed collapsable full-letter">
    {# full letter here, hidden #}
    <header>Full letter</header>
    <textarea name="communication" form="{{task.id}}-form" id="full-letter-{{task.pk}}">
{{foia.agency.address}}

{% now "F j, Y" %}
{% with foia as request %}{% include "text/foia/comms.txt" with show_all_comms=True %}{% endwith %}
    </textarea>
</div>
{% endwith %}
{% endblock %}

{% block task-actions %}
    <div class="form-field">
        <label for="id_status">Set Status</label>
        <select name="status" id="id_status">
            <option value="" selected>---</option>
        {% for s in status %}
            <option value="{{s|first}}">{{s|last}}</option>
        {% endfor %}
        </select>
    </div>
    {% if task.category == 'p' %}
    <div class="form-field">
        <label for="id_check_number">Check Number</label>
        <input type="number" name="check_number" id="id_check_number" />
    </div>
    {% endif %}
    <label for="update-date-{{task.pk}}">
        <input type="checkbox" name="update_date" id="update-date-{{task.pk}}" checked />
        Save the communication with today's date.
    </label>
    <button class="primary" type="submit" name="resolve" value="true">Save & Resolve</button>
{% endblock %}
