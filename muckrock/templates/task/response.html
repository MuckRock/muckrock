{% extends 'task/default.html' %}

{% block task-class %}
    response
{% endblock %}

{% block task-data %}
{% if task.created_from_orphan %}
<p class="created-from-orphan">This response was created from an orphan task.</p>
{% endif %}
<dl class="task-data">
    {% with task.communication as comm %}
    {% if comm.priv_from_who %}
    <dt>From</dt>
    <dd>{{comm.priv_from_who}}</dd>
    {% endif %}
    {% if comm.subject %}
    <dt>Subject</dt>
    <dd>{{comm.subject}}</dd>
    {% endif %}
    {% if comm.foia %}
    <dt>Request</dt>
    <dd><a href="{% url 'admin:foia_foiarequest_change' comm.foia.pk %}">{{comm.foia}}</a></dd>
    <dt>Tracking Number</dt>
    <dd>{{comm.foia.tracking_id}}</dd>
    {% endif %}
    {% if attachments %}
    <dt>Attachments</dt>
        {% for file in attachments %}
    <dd>{% include "lib/file.html" %}</dd>
        {% endfor %}
    {% endif %}
    {% endwith %}
	{% if task.predicted_status %}
	<dt>Predicted Status</dt>
	<dd>{{task.get_predicted_status_display}}</dd>
	<dt>Probability</dt>
	<dd>{{task.status_probability}}%</dd>
	{% endif %}
</dl>
{% endblock %}

{% block task-actions %}
    {{ response_form }}
    <button type="submit" name="resolve" value="true" class="primary">Save & Resolve</button>
{% endblock %}

{% block task-extra-context %}
<div class="task-extra-context response-communication">
    <button class="reveal-extra-context" data-state="0">More Info</button>
    <dl class="extra-context hidden">
        <dt>Full Text</dt>
        <dd>{{task.communication.communication}}</dd>
        {% if task.communication.foia.reverse_communications %}
        <dt>Previous Communications</dt>
            {% for comm in task.communication.foia.reverse_communications %}
        <dd>
            <div class="communication">
                <header>
                    {% if comm.from_who %}
                    <p>From: {{ comm.from_who }}</p>
                    {% endif %}
                    {% if comm.date %}
                    <time datetime="{{comm.date}}">{{ comm.date|date:"m/d/Y" }}</time>
                    {% endif %}
                </header>
                {% if comm.communication %}
                    <p>{{ comm.communication }}</p>
                {% endif %}
            </div>
        </dd>
            {% endfor %}
        {% endif %}
    </dl>
</div>
{% endblock %}
