{% extends 'base.html' %}

{% load humanize %}
{% load static %}
{% load foia_tags %}
{% load news_tags %}
{% load tags %}
{% load cache %}

{% block scripts %}
<script>
  function initializeTabSwitcher() {
      const tabs = document.querySelectorAll('.tab');
      const billboards = document.querySelectorAll('.billboard');
      let isUserScrolling = false;
      
      function updateActiveTab(targetTab) {
          // Remove active class from all tabs
          tabs.forEach(t => t.classList.remove('active'));
          
          // Remove active class from all billboards
          billboards.forEach(b => b.classList.remove('active'));
          
          // Add active class to target tab
          const targetTabElement = document.querySelector(`[data-tab="${targetTab}"]`);
          if (targetTabElement) {
              targetTabElement.classList.add('active');
          }
          
          // Add active class to corresponding billboard
          const targetBillboard = document.getElementById(targetTab);
          if (targetBillboard) {
              targetBillboard.classList.add('active');
          }
      }
      
      function switchToTab(targetTab) {
          updateActiveTab(targetTab);
          
          // Scroll the billboard into view
          const targetBillboard = document.getElementById(targetTab);
          if (targetBillboard) {
              targetBillboard.scrollIntoView({
                  behavior: 'smooth',
                  block: 'nearest'
              });
          }
      }
      
      // Set up Intersection Observer to detect visible billboards
      function initializeScrollSync() {
          const observerOptions = {
              root: null,
                rootMargin: '0px 0px 0px -20%', // Trigger when billboard is 20% from the left edge
              threshold: 0.1
          };
          
          const observer = new IntersectionObserver((entries) => {
              if (isUserScrolling) return; // Skip updates during programmatic scrolling
              
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      const billboardId = entry.target.id;
                      updateActiveTab(billboardId);
                  }
              });
          }, observerOptions);
          
          // Observe all billboards
          billboards.forEach(billboard => {
              if (billboard.id) {
                  observer.observe(billboard);
              }
          });
      }
      
      // Attach click handlers to tabs
      tabs.forEach(tab => {
          tab.addEventListener('click', function() {
              const targetTab = this.getAttribute('data-tab');
              
              // Set flag to prevent scroll sync during programmatic scrolling
              isUserScrolling = true;
              switchToTab(targetTab);
              
              // Reset flag after scroll animation completes
              setTimeout(() => {
                  isUserScrolling = false;
              }, 800); // Slightly longer than typical smooth scroll duration
          });
      });
      
      // Initialize scroll synchronization
      initializeScrollSync();
      
      // Return API for external use
      return {
          switchToTab: switchToTab
      };
  }

  document.addEventListener('DOMContentLoaded', function() {
      initializeTabSwitcher();
  });
</script>
{% endblock %}

{% block content %}
<div class="homepage-2025">
	<div class="homepage-section" id="about-us">
    <div class="text-column">
      <h2>We give you the tools to keep government transparent and accountable</h2>
      <p>MuckRock Foundation is a nonprofit, collaborative news site that brings together journalists, researchers and the public to request, analyze and share government information, making politics more transparent and democracy more informed.</p>
      <ul class="actions-list">
        <li><a href="" class="ghost button red">Donate</a></li>
        <li><a href="" class="ghost button primary">Shop merch</a></li>
        <li><a href="" class="ghost button primary">Subscribe to the newsletter</a></li>
        <li><a href="" class="ghost button primary">Learn more about our mission and impact</a></li>
      </ul>
    </div>
	</div>
  <div class="tab-container" id="products">
    {% if not user.is_authenticated %}
    <header class="account" id="muckrock-account">
      <h3>Access tools from MuckRock and our partners with a single account</h3>
      <div class="account-actions">
        <a href="{% url 'accounts-signup' %}" class="primary button">Sign up</a>
        <a href="{% url 'acct-login' %}" class="primary ghost button">Sign in</a>
      </div>
    </header>
    {% endif %}
    <ul class="tabs">
      <li class="tab active" data-tab="muckrock-requests">MuckRock Requests</li>
      <li class="tab" data-tab="documentcloud">DocumentCloud</li>
      <li class="tab" data-tab="data-liberation-project">The Data Liberation Project</li>
    </ul>
    <div class="tab-viewer">
      <div class="tab-content product active" data-tab="muckrock-requests" id="muckrock-requests">
        <div class="product-content">
          <div class="product-heading">
            <h3>File, track, and share public records requests</h3>
          </div>
          <div class="product-main">
            <div class="product-actions">
              <a href="{% url 'foia-create' %}" class="primary button">File a request</a>
              <a href="" class="primary ghost button">Search requests</a>
              <a href="" class="primary ghost button">Learn how it works</a>
            </div>
            <div class="product-stats">
              <div class="stat">
                <span class="number">{{ stats.request_count|intcomma }}</span>
                <span class="label">filed requests</span>
              </div>
              <div class="stat">
                <span class="number">{{ stats.agency_count|intcomma }}</span>
                <span class="label">agencies</span>
              </div>
              <div class="stat">
                <span class="number">{{ stats.completed_count|intcomma }}</span>
                <span class="label">fulfilled requests</span>
              </div>
              <div class="stat">
                <span class="number">{{ stats.page_count|intcomma }}</span>
                <span class="label">pages released</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="tab-content product" data-tab="documentcloud" id="documentcloud">
        <div class="product-content">
          <div class="product-heading">
            <h3>Upload, analyze, share and embed primary source documents</h3>
          </div>
          <div class="product-main">
            <div class="product-actions">
              <a href="" class="primary button">Upload a document</a>
              <a href="" class="primary ghost button">Search public documents</a>
              <a href="" class="primary ghost button">Learn how it works</a>
            </div>
            <div class="product-stats">
              <div class="stat">
                <span class="number">{{ 6362593|intcomma }}</span>
                <span class="label">public documents</span>
              </div>
              <div class="stat">
                <span class="number">{{ 108791198|intcomma }}</span>
                <span class="label">public pages</span>
              </div>
              <div class="stat">
                <span class="number">{{ 530102|intcomma }}</span>
                <span class="label">public notes</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="tab-content product" data-tab="data-liberation-project" id="data-liberation-project">
        <div class="product-content">
          <div class="product-heading">
            <h3>An initiative to identify, obtain, reformat, clean, document, publish, and disseminate government datasets of public interest</h3>
          </div>
          <div class="product-main">
            <div class="product-actions">
              <a href="" class="primary button">Get involved</a>
              <a href="" class="primary ghost button">Search datasets</a>
              <a href="" class="primary ghost button">Learn how it works</a>
            </div>
            <div class="product-stats">
              <div class="stat">
                <span class="number">{{ 1019|intcomma }}</span>
                <span class="label">participants</span>
              </div>
              <div class="stat">
                <span class="number">140 GB</span>
                <span class="label">data liberated</span>
              </div>
              <div class="stat">
                <span class="number">44</span>
                <span class="label">total datasets</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% newsletter %}
  <div class="tab-container" id="investigations">
    <header>
      <h3>Award-winning investigations and editorial collaborations</h3>
    </header>
    <ul class="tabs">
      <li class="tab active" data-tab="air-we-breathe">The Air We Breathe</li>
      <li class="tab" data-tab="behind-the-badge">Behind the Badge</li>
      <li class="tab" data-tab="anti-trans-actions">Tracking Anti-Trans Federal Actions</li>
    </ul>
    <div class="tab-viewer">
      <div class="tab-content project active" data-tab="air-we-breathe" id="air-we-breathe">
        <div class="project-details">
          <img src="" alt="The Air We Breathe project image" class="project-image" />
          <h4 class="project-title">The Air We Breathe</h4>
          <p class="project-subtitle">How industry is polluting Cicero’s air</p>
          <p class="project-collaboration">In collaboration with <a href="" target="_blank">Cicero Independiente</a></p>
          <p class="project-description">"The Air We Breathe" is a yearlong investigative project by two nonprofit newsrooms, the Cicero Independiente and MuckRock, who have been monitoring air pollution in Cicero. What we found: Cicero’s air quality is much worse than surrounding Cook County neighborhoods, and it’s worse than what the Environmental Protection Agency and pilot programs run by the city and Microsoft have routinely reported.</p>
        </div>
        <div class="project-articles">
          <ul class="articles-list">
            <li class="article-item">
              <a href="{{ article.url }}" class="article-link">
                <img src="" alt="{{ article.title }}" class="article-image" />
                <h5 class="article-title">{{ article.title }}</h5>
                <div class="article-meta">
                  <p class="article-date">{{ article.date|date:"F j, Y" }}</p>
                  <p class="article-author">{{ article.author }}</p>
                </div>
              </a>
            </li>
            <li class="article-item">
              <a href="{{ article.url }}" class="article-link">
                <img src="" alt="{{ article.title }}" class="article-image" />
                <h5 class="article-title">{{ article.title }}</h5>
                <div class="article-meta">
                  <p class="article-date">{{ article.date|date:"F j, Y" }}</p>
                  <p class="article-author">{{ article.author }}</p>
                </div>
              </a>
            </li>
          </ul>
      </div>
    </div>
  </div>
  <div class="homepage-section" id="expertise">
    <header>
      <h3>Expert knowledge and community participation</h3>
    </header>
    <div class="expertise-grid">
      <div class="expertise-item">
        <h4 class="expertise-item-title">FOIAFriday</h4>
        <p class="expertise-item-subtitle">A community podcast about all things FOIA and public records</p>
        <p class="expertise-item-description">We gather once a month to share updates on public records laws and rulings, techniques, tricks and insider tips from fellow requesters.</p>
        <ul class="expertise-item-links">
          <li><a href="" class="primary ghost button">Watch the latest episode</a></li>
          <li><a href="" class="primary ghost button">Join our next call</a></li>
        </ul>
      </div>
      <div class="expertise-item">
        <h4 class="expertise-item-title">Consulting &amp; research</h4>
        <p class="expertise-item-subtitle">On-demand access to experts in public record research methods</p>
        <p class="expertise-item-description">We've partnered with Sunlight Research Center to offer consulting and expertise to newsrooms and businesses.</p>
        <ul class="expertise-item-links">
          <li><a href="" class="primary ghost button">Contact us to learn more</a></li>
        </ul>
      </div>
      <div class="expertise-item">
        <h4 class="expertise-item-title">Workshops &amp; trainings</h4>
        <p class="expertise-item-subtitle">Get live instruction in transparency</p>
        <p class="expertise-item-description">Learn how to use MuckRock Requests, DocumentCloud, and other tools to investigate government.</p>
        <ul class="expertise-item-links">
          <li><a href="" class="primary ghost button">View workshop calendar</a></li>
          <li><a href="" class="primary ghost button">Schedule a training</a></li>
        </ul>
      </div>
      <div class="expertise-item">
        <h4 class="expertise-item-title">Guides &amp; case studies</h4>
        <p class="expertise-item-subtitle">Learn about our research techniques and technologies</p>
        <p class="expertise-item-description">Learn how to use MuckRock Requests, DocumentCloud, and other tools to investigate government.</p>
        <ul class="expertise-item-links">
          <li><a href="" class="primary ghost button">FOIA 101: Tips and Tricks to Make You a Transparency Master</a></li>
          <li><a href="" class="primary ghost button">50 States of FOI: Your Guide to State Records Laws</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
