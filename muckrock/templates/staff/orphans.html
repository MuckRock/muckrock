{% extends "base.html" %}
{% load tags %}
{% load staticfiles %}
{% load humanize %}
{% load markdown_deux_tags %}

{% block title %}MuckRock &bull; Orphaned Communications {% endblock %}

{% block content %}
<article class="orphans">
    {% if communications %}
    <form method="post" id="selected-orphans">
        {% csrf_token %}
        <h1>Orphaned Communications</h1>
        <input type="hidden" name="action" value="" />
        <input type="hidden" name="comm_pk" value="" />
        <div class="top controls">
            <fieldset>
                <input type="checkbox" id="toggle-all" />
                <label for="toggle_all">Select/Unselect All</label>
            </fieldset>
            <span class="default button" id="collapse-all">Collapse All</span>
            <input type="submit" name="submit" value="Delete Selected" class="button" 
                         onclick="$('input[name=action]').val('delete_selected'); return confirm('Are you sure?');" />
        </div>
    </form>
    {% endif %}
    {% for comm in communications %}
    <div class="orphan">
        <div class="orphan-head">
            <div><input name="comm_pks" type="checkbox" value="{{comm.pk}}" form="selected-orphans" /></div>
            {% if comm.priv_to_who %}
            <div><strong>To: {{comm.priv_to_who}}</strong></div>
            {% endif %}
        </div>
        <div class="orphan-body">
        {% if comm.full_html %}
            {% include 'lib/message.html' with user=comm.priv_from_who response=comm.response date=comm.date uid=comm.anchor files=comm.files.all body=comm.communication|redact_emails|safe %}
        {% else %}
            {% include 'lib/message.html' with user=comm.priv_from_who response=comm.response date=comm.date uid=comm.anchor files=comm.files.all body=comm.communication|redact_emails|urlize|linebreaks %}
        {% endif %}

        {% include 'lib/comm_actions.html' with muckrock_number=comm.likely_foia.pk %}
        </div>
    </div>
    {% empty %}
    <h2>There&rsquo;s no orphans. Nice!</h2>
    {% endfor %}
</article>
    {% with communications as page_obj %}
        {% include 'lib/pagination.html' %}
    {% endwith %}
{% endblock %}

{% block scripts %}
<script type="text/javascript">
$('#collapse-all').on('click', function(){
    $('.message .visibility').each(function(){
        $(this).trigger('click');
    });
    if ($(this).text() == "Collapse All") {
        $(this).text("Reveal All");
    } else {
        $(this).text("Collapse All");
    }
});
</script>
{% endblock scripts %}
